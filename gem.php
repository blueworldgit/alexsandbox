<?php
include("./db.php");


error_reporting(E_ERROR | E_WARNING | E_PARSE);

 header("Content-Type: text/html;charset=UTF-8");


function _uniord($c) {
    if (ord($c{0}) >=0 && ord($c{0}) <= 127)
        return ord($c{0});
    if (ord($c{0}) >= 192 && ord($c{0}) <= 223)
        return (ord($c{0})-192)*64 + (ord($c{1})-128);
    if (ord($c{0}) >= 224 && ord($c{0}) <= 239)
        return (ord($c{0})-224)*4096 + (ord($c{1})-128)*64 + (ord($c{2})-128);
    if (ord($c{0}) >= 240 && ord($c{0}) <= 247)
        return (ord($c{0})-240)*262144 + (ord($c{1})-128)*4096 + (ord($c{2})-128)*64 + (ord($c{3})-128);
    if (ord($c{0}) >= 248 && ord($c{0}) <= 251)
        return (ord($c{0})-248)*16777216 + (ord($c{1})-128)*262144 + (ord($c{2})-128)*4096 + (ord($c{3})-128)*64 + (ord($c{4})-128);
    if (ord($c{0}) >= 252 && ord($c{0}) <= 253)
        return (ord($c{0})-252)*1073741824 + (ord($c{1})-128)*16777216 + (ord($c{2})-128)*262144 + (ord($c{3})-128)*4096 + (ord($c{4})-128)*64 + (ord($c{5})-128);
    if (ord($c{0}) >= 254 && ord($c{0}) <= 255)    //  error
        return FALSE;
    return 0;
}

function mb_str_split($string) {
    $strlen = mb_strlen($string);
    while ($strlen) {
        $array[] = mb_substr($string,-1,1,"UTF-8");
        $string = mb_substr($string,0,$strlen-1,"UTF-8");
        $strlen = mb_strlen($string);

////////print_r ($array);
    }
    return $array;
}

/*  

$hebrewText ="אבגדהוזחטיכלמנסעפצקרשתךםןףץ";


  $hebrewText ="
 

   ץףןםךתשרקצפעסנמלכיטחזוהדגבא
";

*/


 


//$hebrewText="וַיַּ֣עַשׂאֱלֹהִים֮אֶתהָרָקִיעַ֒וַיַּבְדֵּ֗לבֵּ֤יןהַמַּ֙יִם֙אֲשֶׁר֙מִתַּ֣חַתלָרָקִ֔יעַוּבֵ֣יןהַמַּ֔יִםאֲשֶׁ֖רמֵעַ֣ללָרָקִ֑יעַוַֽיְהִיכֵֽן׃";

function mb_strrev($str){
    $r = '';
    for ($i = mb_strlen($str); $i>=0; $i--) {
        $r .= mb_substr($str, $i, 1);
    }
    return $r;
}


 $query = mysqli_query($conn, "SELECT * FROM `hebrew` WHERE `state` = 9");




while ($row = mysqli_fetch_array($query)) {
	
	//echo $rowcount;
	
 
 //$standardword[]=NULL;
 
 
 unset($standardword);
 
 
 echo "<pre>";
 
 print_r($standardword);
 
 
  echo "</pre>";
 
 
 
 
	
	
	$hebrewText=$row['word'];

$hebrewText=mb_strrev($hebrewText);


 /*  $hebrewText ="
 כוןלגרקצפעסנמלכ
"; */

//echo $hebrewText;

//echo "<p></p>";

$text = mb_str_split($hebrewText); //splitting text into symbols

$word = [];

$lookupOrdChrs = array(
    '1488'=>1, //1
    '14681489'=>281,
    '1489'=>2, //2
    '1490'=>3, //3
    '1491'=>4, //4
    '1492'=>5, //5
    '1493'=>6, //6
    '1494'=>7, //7
    '1495'=>8, //8
    '1496'=>9, //9
    '1497'=>10, //10
    '14681499'=>291,
    '1499'=>11, //11
    '14681498'=>293,
    '1498'=>11, //23
    '1500'=>12, //12
    '1502'=>13, //13
    '1501'=>13,  //24
    '1504'=>14,  //14
    '1503'=>14,  //25
    '1505'=>15,  //15
    '1506'=>16,  //16
    '14681508'=>302,
    '1508'=>17,  //17
    '1507'=>17,  //26
    '1510'=>18,  //18
    '1509'=>18,  //27
    '1511'=>19,  //19
    '1512'=>20,  //20
  '1513'=>21,   //21
    '14731513'=>309,
    '14741513'=>310,
    '14681514'=>311,
    '1514'=>22 //22 
    );

$SimpleReducedChrs = array(
    '1488'=>1, //1
    '14681489'=>281,
    '1489'=>2, //2
    '1490'=>3, //3
    '1491'=>4, //4
    '1492'=>5, //5
    '1493'=>6, //6
    '1494'=>7, //7
    '1495'=>8, //8
    '1496'=>9, //9
    '1497'=>1, //10
    '14681499'=>291,
    '1499'=>2, //11
    '14681498'=>293,
    '1498'=>2, //23
    '1500'=>3, //12
    '1502'=>4, //13
    '1501'=>4,  //24
    '1504'=>5,  //14
    '1503'=>5,  //25
    '1505'=>6,  //15
    '1506'=>7,  //16
    '14681508'=>302,
    '1508'=>8,  //17
    '1507'=>8,  //26
    '1510'=>9,  //18
    '1509'=>9,  //27
    '1511'=>1,  //19
    '1512'=>2,  //20
  '1513'=>3,   //21
    '14731513'=>309,
    '14741513'=>310,
    '14681514'=>311,
    '1514'=>4 //22 
    );


 $lookupStandardChrs = array(
    '1488'=>1, //1
    '14681489'=>281,
    '1489'=>2, //2
    '1490'=>3, //3
    '1491'=>4, //4
    '1492'=>5, //5
    '1493'=>6, //6
    '1494'=>7, //7
    '1495'=>8, //8
    '1496'=>9, //9
    '1497'=>10, //10
    '14681499'=>291,
    '1499'=>20, //11
    '14681498'=>293,
    '1498'=>20, //23
    '1500'=>30, //12
    '1502'=>40, //13
    '1501'=>40,  //24
    '1504'=>50,  //14
    '1503'=>50,  //25
    '1505'=>60,  //15
    '1506'=>70,  //16
    '14681508'=>302,
    '1508'=>80,  //17
    '1507'=>80,  //26
    '1510'=>90,  //18
    '1509'=>90,  //27
    '1511'=>100,  //19
    '1512'=>200,  //20
  '1513'=>300,   //21
    '14731513'=>309,
    '14741513'=>310,
    '14681514'=>311,
    '1514'=>400 //22 
    ); 

$lookupFullReducedChrs = array(
    '1488'=>12, //1
    '14681489'=>281,
    '1489'=>7, //2
    '1490'=>11, //3
    '1491'=>11, //4
    '1492'=>6, //5
    '1493'=>12, //6
    '1494'=>13, //7
    '1495'=>13, //8d
    '1496'=>14, //9
    '1497'=>11, //10
    '14681499'=>291,
    '1499'=>10, //11
    '14681498'=>293,
    '1498'=>10, //23
    '1500'=>11, //12
    '1502'=>8, //13
    '1501'=>8,  //24
    '1504'=>16,  //14
    '1503'=>16,  //25
    '1505'=>12,  //15
    '1506'=>13,  //16
    '14681508'=>302,
    '1508'=>13,  //17
    '1507'=>13,  //26
    '1510'=>14,  //18
    '1509'=>14,  //27
    '1511'=>15,  //19
    '1512'=>6,  //20
  '1513'=>9,   //21
    '14731513'=>309,
    '14741513'=>310,
    '14681514'=>311,
    '1514'=>10 //22 
    ); 


/* $lookupChrs = array(
    '1488'=>280, //1
    '14681489'=>281,
    '1489'=>282, //2
    '1490'=>283, //3
    '1491'=>284, //4
    '1492'=>285, //5
    '1493'=>286, //6
    '1494'=>287, //7
    '1495'=>288, //8
    '1496'=>289, //9
    '1497'=>290, //10
    '14681499'=>291,
    '1499'=>292, //11
    '14681498'=>293,
    '1498'=>294, //23
    '1500'=>295, //12
    '1502'=>296, //13
    '1501'=>297,  //24
    '1504'=>298,  //14
    '1503'=>299,  //25
    '1505'=>300,  //15
    '1506'=>301,  //16
    '14681508'=>302,
    '1508'=>303,  //17
    '1507'=>304,  //26
    '1510'=>305,  //18
    '1509'=>306,  //27
    '1511'=>307,  //19
    '1512'=>308,  //20
  '1513'=>3088,   //21
    '14731513'=>309,
    '14741513'=>310,
    '14681514'=>311,
    '1514'=>312 //22 
    ); */


 $lookupFullOrdinalChrs = array(
    '1488'=>30, //1
    '14681489'=>281,
    '1489'=>34, //2
    '1490'=>38, //3
    '1491'=>38, //4
    '1492'=>6, //5
    '1493'=>12, //6
    '1494'=>31, //7
    '1495'=>40, //8
    '1496'=>41, //9
    '1497'=>20, //10
    '14681499'=>291,
    '1499'=>28, //11
    '14681498'=>293,
    '1498'=>28, //23
    '1500'=>29, //12
    '1502'=>26, //13
    '1501'=>26,  //24
    '1504'=>34,  //14
    '1503'=>34,  //25
    '1505'=>39,  //15
    '1506'=>40,  //16
    '14681508'=>302,
    '1508'=>22,  //17
    '1507'=>22,  //26
    '1510'=>32,  //18
    '1509'=>32,  //27
    '1511'=>42,  //19
    '1512'=>51,  //20
  '1513'=>45,   //21
    '14731513'=>309,
    '14741513'=>310,
    '14681514'=>311,
    '1514'=>28 //22 
    ); 


 $lookupFullStandardChrs = array(
    '1488'=>111, //1
    '14681489'=>281,
    '1489'=>412, //2
    '1490'=>83, //3
    '1491'=>434, //4
    '1492'=>6, //5
    '1493'=>12, //6
    '1494'=>67, //7
    '1495'=>418, //8
    '1496'=>419, //9
    '1497'=>20, //10
    '14681499'=>291,
    '1499'=>100, //11
    '14681498'=>293,
    '1498'=>100, //23
    '1500'=>74, //12
    '1502'=>80, //13
    '1501'=>80,  //24
    '1504'=>106,  //14
    '1503'=>106,  //25
    '1505'=>120,  //15
    '1506'=>130,  //16
    '14681508'=>302,
    '1508'=>85,  //17
    '1507'=>85,  //26
    '1510'=>104,  //18
    '1509'=>104,  //27
    '1511'=>186,  //19
    '1512'=>510,  //20
  '1513'=>360,   //21
    '14731513'=>309,
    '14741513'=>310,
    '14681514'=>311,
    '1514'=>406 //22 
    ); 


 $ReversedReducedChrs = array(
    '1488'=>4, //1
    '14681489'=>281,
    '1489'=>3, //2
    '1490'=>2, //3
    '1491'=>1, //4
    '1492'=>9, //5
    '1493'=>8, //6
    '1494'=>7, //7
    '1495'=>6, //8
    '1496'=>5, //9
    '1497'=>4, //10
    '14681499'=>291,
    '1499'=>3, //11
    '14681498'=>293,
    '1498'=>3, //23
    '1500'=>2, //12
    '1502'=>1, //13
    '1501'=>1,  //24
    '1504'=>9,  //14
    '1503'=>9,  //25
    '1505'=>8,  //15
    '1506'=>7,  //16
    '14681508'=>302,
    '1508'=>6,  //17
    '1507'=>6,  //26
    '1510'=>5,  //18
    '1509'=>5,  //27
    '1511'=>4,  //19
    '1512'=>3,  //20
  '1513'=>2,   //21
    '14731513'=>309,
    '14741513'=>310,
    '14681514'=>311,
    '1514'=>1 //22 
    ); 


/* $lookupChrs = array(
    '1488'=>280, //1
    '14681489'=>281,
    '1489'=>282, //2
    '1490'=>283, //3
    '1491'=>284, //4
    '1492'=>285, //5
    '1493'=>286, //6
    '1494'=>287, //7
    '1495'=>288, //8
    '1496'=>289, //9
    '1497'=>290, //10
    '14681499'=>291,
    '1499'=>292, //11
    '14681498'=>293,
    '1498'=>294, //23
    '1500'=>295, //12
    '1502'=>296, //13
    '1501'=>297,  //24
    '1504'=>298,  //14
    '1503'=>299,  //25
    '1505'=>300,  //15
    '1506'=>301,  //16
    '14681508'=>302,
    '1508'=>303,  //17
    '1507'=>304,  //26
    '1510'=>305,  //18
    '1509'=>306,  //27
    '1511'=>307,  //19
    '1512'=>308,  //20
  '1513'=>3088,   //21
    '14731513'=>309,
    '14741513'=>310,
    '14681514'=>311,
    '1514'=>1 //22 
    ); */

 $ReversedOrdinalChrs = array(
    '1488'=>22, //1
    '14681489'=>281,
    '1489'=>21, //2
    '1490'=>20, //3
    '1491'=>19, //4
    '1492'=>18, //5
    '1493'=>17, //6
    '1494'=>16, //7
    '1495'=>15, //8
    '1496'=>14, //9
    '1497'=>13, //10
    '14681499'=>291,
    '1499'=>12, //11
    '14681498'=>293,
    '1498'=>12, //23
    '1500'=>11, //12
    '1502'=>10, //13
    '1501'=>10,  //24
    '1504'=>9,  //14
    '1503'=>9,  //25
    '1505'=>8,  //15
    '1506'=>7,  //16
    '14681508'=>302,
    '1508'=>6,  //17
    '1507'=>6,  //26
    '1510'=>5,  //18
    '1509'=>5,  //27
    '1511'=>4,  //19
    '1512'=>3,  //20
  '1513'=>2,   //21
    '14731513'=>309,
    '14741513'=>310,
    '14681514'=>311,
    '1514'=>1 //22 
    ); 

 $ReversedStandardChrs = array(
    '1488'=>400, //1
    '14681489'=>281,
    '1489'=>300, //2
    '1490'=>200, //3
    '1491'=>100, //4
    '1492'=>90, //5
    '1493'=>80, //6
    '1494'=>70, //7
    '1495'=>60, //8
    '1496'=>50, //9
    '1497'=>40, //10
    '14681499'=>291,
    '1499'=>30, //11
    '14681498'=>293,
    '1498'=>30, //23
    '1500'=>20, //12
    '1502'=>10, //13
    '1501'=>10,  //24
    '1504'=>9,  //14
    '1503'=>9,  //25
    '1505'=>8,  //15
    '1506'=>7,  //16
    '14681508'=>302,
    '1508'=>6,  //17
    '1507'=>6,  //26
    '1510'=>5,  //18
    '1509'=>5,  //27
    '1511'=>4,  //19
    '1512'=>3,  //20
  '1513'=>2,   //21
    '14731513'=>309,
    '14741513'=>310,
    '14681514'=>311,
    '1514'=>1 //22 
    ); 

 $ReducedChrs = array(
    '1488'=>400, //1
    '14681489'=>281,
    '1489'=>300, //2
    '1490'=>200, //3
    '1491'=>100, //4
    '1492'=>90, //5
    '1493'=>80, //6
    '1494'=>70, //7
    '1495'=>60, //8
    '1496'=>50, //9
    '1497'=>40, //10
    '14681499'=>291,
    '1499'=>30, //11
    '14681498'=>293,
    '1498'=>30, //23
    '1500'=>20, //12
    '1502'=>10, //13
    '1501'=>10,  //24
    '1504'=>9,  //14
    '1503'=>9,  //25
    '1505'=>8,  //15
    '1506'=>7,  //16
    '14681508'=>302,
    '1508'=>6,  //17
    '1507'=>6,  //26
    '1510'=>5,  //18
    '1509'=>5,  //27
    '1511'=>4,  //19
    '1512'=>3,  //20
  '1513'=>2,   //21
    '14731513'=>309,
    '14741513'=>310,
    '14681514'=>311,
    '1514'=>1 //22 
    ); 


////////print_r ($text);

$standardtext=$text;

foreach($text as $t){
    $lookupChr = _uniord(array_shift($text));
    $lookupChr = (string)$lookupChr;
    //handle accents (two charactrers instead of one)
    if($lookupChr == "1468" || $lookupChr == "1473" || $lookupChr == "1474"){
        //accent detected, combine with next character
        //echo "\"" . $lookupChr . "\":\"" . _uniord(array_shift($text)) . "\"";
        $lookupChr .= _uniord(array_shift($text));
    }
    if($lookupChr != "0"){
        $word[] = $lookupOrdChrs[$lookupChr];
    }
}
//echo "<pre>";
//////print_r($word);

//echo "<p></p>";

$count=0;

foreach($word as $t){
$count=$count+$t;


}
//echo "ordinal total is ";
//echo $count;

////echo "<p></p>";


$standardtext = mb_str_split($hebrewText);
//////print_r ($standardtext);
foreach($standardtext as $t){
    $lookupChr = _uniord(array_shift($standardtext));
    $lookupChr = (string)$lookupChr;
    //handle accents (two charactrers instead of one)
    if($lookupChr == "1468" || $lookupChr == "1473" || $lookupChr == "1474"){
        //accent detected, combine with next character
        //echo "\"" . $lookupChr . "\":\"" . _uniord(array_shift($text)) . "\"";
        $lookupChr .= _uniord(array_shift($text));
    }
    if($lookupChr != "0"){
        $standardword[] = $lookupStandardChrs[$lookupChr];
    }
}
//echo "<pre>";
//echo "<p></p>";
//////print_r($standardword);
echo "</pre>";

$count=0;

foreach($standardword as $t){
$count=$count+$t;


}
//echo "Standard total is ";
//echo $count;

////echo "<p></p>";



//echo "Full Ordinal total is ";
//echo $count;

////echo "<p></p>";





//echo "Reversed Ordinal total is ";
//echo $count;

////echo "<p></p>";






//////print_r ($simplereducedtext);





//echo "Reduced total is ";
//echo $count;

////echo "<p></p>";

//OUTPUT:
//    Array
//    (
//        [0] => 285
//        [1] => 295
//        [2] => 290
//        [3] => 296
//  
$standardtext = mb_str_split($hebrewText);
////////print_r($simplereducedtext);
?>





	
	<?php
	$standardtotal=0;


		
		foreach($standardword as $t){



		
		if($t==" ") {$filler=" ";} else {
 
		$standardtotal=$standardtotal+$t;}
		

}

 
 

 
 
 echo "<p>BOOK ". $row['book']."</p>";
 
  echo "<p>CHAPTER ". $row['chapter']."</p>";
  
    echo "<p>VERSE ". $row['verse']."</p>";
	
	  echo "<h3>VALUE ". $standardtotal."</h3>";
	

	$id=$row['id'];
	
	
	$writequery = "UPDATE `hebrew` SET `value` = '{$standardtotal}' WHERE `hebrew`.`id` = '{$id}'";
	
	
if (mysqli_query($conn, $writequery)) {
    echo "New record created successfully";
	
	changestate($conn,$id,'1');
} else {
    echo "Error: " . $writequery . "<br>" . mysqli_error($conn);
}

	
	
	 echo "<h1>".$standardtotal."</h1>";
 
 
 

 


	
	
}
	?>
	
	






